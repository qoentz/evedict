package view

import (
    "fmt"
    "github.com/qoentz/evedict/internal/llm"
)

templ PredictionFeed(predictions []llm.Prediction) {
    <div class="prediction-container">
        for _, p := range predictions {
            <div class="prediction-item">
                <div class="prediction-content">
                    <img src={ p.ImageURL } alt="Prediction image" class="prediction-image" />
                    <div class="prediction-details">
                        <h2 class="prediction-headline">{ p.Headline }</h2>
                        <p class="prediction-summary">{ p.Summary }</p>
                    </div>
                </div>

                <!-- Outcomes container with page fold effect button -->
                <div class="outcomes-container">
                    <div class="toggle-button" onclick="toggleSources(this)" title="Sources"></div>
                    <h3 class="outcomes-title">Outcomes</h3>
                    for _, outcome := range p.Outcomes {
                        <div class={ "outcome-item", confidenceClass(outcome.ConfidenceLevel) }>
                            <div class="percentage-display">
                                { fmt.Sprintf("%d", outcome.ConfidenceLevel) }%
                            </div>
                            <p class="outcome-content">{ outcome.Content }</p>
                        </div>
                    }
                </div>

                <!-- Sources list with identical styling and back button -->
                <div class="sources-list hidden">
                    <div class="toggle-button" onclick="toggleSources(this)" title="Outcomes"></div>
                    <h3 class="sources-title">Sources</h3>
                    <ul>
                            for _, source := range p.Sources {
                                <li>
                                    <a href={ templ.URL(source.URL) } target="_blank" class="source-title">{ source.Title }</a>
                                    <span class="source-name"> - <em>{ source.Name }</em></span>
                                </li>
                            }
                        </ul>
                </div>
            </div>
        }
    </div>
}




func confidenceClass(confidence int) string {
    if confidence >= 70 {
        return "high"
    } else if confidence >= 40 {
        return "medium"
    } else {
        return "low"
    }
}



